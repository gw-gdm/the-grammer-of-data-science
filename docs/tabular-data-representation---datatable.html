<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 2 Tabular Data Representation - DataTable | A Minimal Book Example</title>
<meta name="author" content="Yihui Xie">
<meta name="description" content="2.1 DataTable Schema Most data science programming languages derive the DataTable schema from the data source. This is easy when the data source itself has a schema, such as a SQL table, or the...">
<meta name="generator" content="bookdown 0.28 with bs4_book()">
<meta property="og:title" content="Chapter 2 Tabular Data Representation - DataTable | A Minimal Book Example">
<meta property="og:type" content="book">
<meta property="og:description" content="2.1 DataTable Schema Most data science programming languages derive the DataTable schema from the data source. This is easy when the data source itself has a schema, such as a SQL table, or the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 2 Tabular Data Representation - DataTable | A Minimal Book Example">
<meta name="twitter:description" content="2.1 DataTable Schema Most data science programming languages derive the DataTable schema from the data source. This is easy when the data source itself has a schema, such as a SQL table, or the...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Minimal Book Example</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Prerequisites</a></li>
<li><a class="active" href="tabular-data-representation---datatable.html"><span class="header-section-number">2</span> Tabular Data Representation - DataTable</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">3</span> Introduction</a></li>
<li><a class="" href="literature.html"><span class="header-section-number">4</span> Literature</a></li>
<li><a class="" href="methods.html"><span class="header-section-number">5</span> Methods</a></li>
<li><a class="" href="applications.html"><span class="header-section-number">6</span> Applications</a></li>
<li><a class="" href="final-words.html"><span class="header-section-number">7</span> Final Words</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tabular-data-representation---datatable" class="section level1" number="2">
<h1>
<span class="header-section-number">2</span> Tabular Data Representation - DataTable<a class="anchor" aria-label="anchor" href="#tabular-data-representation---datatable"><i class="fas fa-link"></i></a>
</h1>
<div id="datatable-schema" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> DataTable Schema<a class="anchor" aria-label="anchor" href="#datatable-schema"><i class="fas fa-link"></i></a>
</h2>
<p>Most data science programming languages derive the DataTable schema from the data source. This is easy when the
data source itself has a schema, such as a SQL table, or the data source itself is consistent and complete, such
as a CSV file with no missing field in itâ€™s first row.</p>
<p>In real world, we often work with imperfect data so a defining the schema upfront is preferred.</p>
<p><strong>Example</strong> The FTX exchange provides a RESTful API for users to retrieve balance of all tokens in their wallet.
When the wallet has at least one token with non-trivial balance, the response message body like the following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="tabular-data-representation---datatable.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="tabular-data-representation---datatable.html#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"success"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="tabular-data-representation---datatable.html#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"result"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb2-4"><a href="tabular-data-representation---datatable.html#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb2-5"><a href="tabular-data-representation---datatable.html#cb2-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"coin"</span><span class="fu">:</span> <span class="st">"ETH"</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="tabular-data-representation---datatable.html#cb2-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"total"</span><span class="fu">:</span> <span class="fl">-0.05008361</span><span class="fu">,</span></span>
<span id="cb2-7"><a href="tabular-data-representation---datatable.html#cb2-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"free"</span><span class="fu">:</span> <span class="fl">0.60553512</span><span class="fu">,</span></span>
<span id="cb2-8"><a href="tabular-data-representation---datatable.html#cb2-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"availableForWithdrawal"</span><span class="fu">:</span> <span class="fl">0.60553512</span><span class="fu">,</span></span>
<span id="cb2-9"><a href="tabular-data-representation---datatable.html#cb2-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"availableWithoutBorrow"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb2-10"><a href="tabular-data-representation---datatable.html#cb2-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"usdValue"</span><span class="fu">:</span> <span class="fl">-65.54655549160535</span><span class="fu">,</span></span>
<span id="cb2-11"><a href="tabular-data-representation---datatable.html#cb2-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"spotBorrow"</span><span class="fu">:</span> <span class="fl">0.05008361</span></span>
<span id="cb2-12"><a href="tabular-data-representation---datatable.html#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb2-13"><a href="tabular-data-representation---datatable.html#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb2-14"><a href="tabular-data-representation---datatable.html#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>We can easily convert this JSON object into a DataTable in python:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="tabular-data-representation---datatable.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb3-2"><a href="tabular-data-representation---datatable.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb3-3"><a href="tabular-data-representation---datatable.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="tabular-data-representation---datatable.html#cb3-4" aria-hidden="true" tabindex="-1"></a>resp <span class="op">=</span> requests.get(<span class="st">"https://ftx.com/api/wallet/balances"</span>) <span class="co"># ignore authentication</span></span>
<span id="cb3-5"><a href="tabular-data-representation---datatable.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> resp.status_code <span class="op">==</span> <span class="dv">200</span>, <span class="ss">f"Request failed </span><span class="sc">{</span>resp<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb3-6"><a href="tabular-data-representation---datatable.html#cb3-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> DataFrame(resp.json()[<span class="st">"result"</span>])</span></code></pre></div>
<p>However, if the wallet is empty, the response body becomes:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="tabular-data-representation---datatable.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="tabular-data-representation---datatable.html#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"success"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="tabular-data-representation---datatable.html#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"result"</span><span class="fu">:</span> <span class="ot">[]</span></span>
<span id="cb4-4"><a href="tabular-data-representation---datatable.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>With this empty response, the python script above would generate an empty DataFrame with completely different
schema. The proper way to set schema is to explicitly specify the column names and types:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="tabular-data-representation---datatable.html#cb5-1" aria-hidden="true" tabindex="-1"></a>responsJson <span class="op">=</span> []  <span class="co"># assume we got empty data from the API response</span></span>
<span id="cb5-2"><a href="tabular-data-representation---datatable.html#cb5-2" aria-hidden="true" tabindex="-1"></a>I <span class="op">=</span> <span class="kw">lambda</span> x: x.split(<span class="st">","</span>)</span>
<span id="cb5-3"><a href="tabular-data-representation---datatable.html#cb5-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> DataFrame(</span>
<span id="cb5-4"><a href="tabular-data-representation---datatable.html#cb5-4" aria-hidden="true" tabindex="-1"></a>    responsJson, </span>
<span id="cb5-5"><a href="tabular-data-representation---datatable.html#cb5-5" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>I(<span class="st">"coin,total,free,availableForWithdrawal,availableWithoutBorrow,usdValue,spotBorrow"</span>)</span>
<span id="cb5-6"><a href="tabular-data-representation---datatable.html#cb5-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-7"><a href="tabular-data-representation---datatable.html#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> I(<span class="st">"total,free,availableForWithdrawal,availableWithoutBorrow,usdValue,spotBorrow"</span>):</span>
<span id="cb5-8"><a href="tabular-data-representation---datatable.html#cb5-8" aria-hidden="true" tabindex="-1"></a>  df[col] <span class="op">=</span> pd.to_numeric(df[col])</span></code></pre></div>
<p>As you can see, this is verbose. Even worse, the logic is implemeted in two steps:</p>
<ul>
<li>step 1, set column names and load data;</li>
<li>step 2, set schema for each column (and cast column types if necessary).</li>
</ul>
<p>This is un-natural. The better way to implement this would be:</p>
<ul>
<li>step 1, set column names and types;</li>
<li>step 2, load data.</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="index.html"><span class="header-section-number">1</span> Prerequisites</a></div>
<div class="next"><a href="intro.html"><span class="header-section-number">3</span> Introduction</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tabular-data-representation---datatable"><span class="header-section-number">2</span> Tabular Data Representation - DataTable</a></li>
<li><a class="nav-link" href="#datatable-schema"><span class="header-section-number">2.1</span> DataTable Schema</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Minimal Book Example</strong>" was written by Yihui Xie. It was last built on 2022-09-25.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
