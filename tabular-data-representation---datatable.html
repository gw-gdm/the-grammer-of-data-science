<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Tabular Data Representation - DataTable | A Minimal Book Example</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Tabular Data Representation - DataTable | A Minimal Book Example" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Tabular Data Representation - DataTable | A Minimal Book Example" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Yihui Xie" />


<meta name="date" content="2022-09-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="intro.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="tabular-data-representation---datatable.html"><a href="tabular-data-representation---datatable.html"><i class="fa fa-check"></i><b>2</b> Tabular Data Representation - DataTable</a><ul>
<li class="chapter" data-level="2.1" data-path="tabular-data-representation---datatable.html"><a href="tabular-data-representation---datatable.html#datatable-schema"><i class="fa fa-check"></i><b>2.1</b> DataTable Schema</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>3</b> Introduction</a></li>
<li class="chapter" data-level="4" data-path="literature.html"><a href="literature.html"><i class="fa fa-check"></i><b>4</b> Literature</a></li>
<li class="chapter" data-level="5" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>5</b> Methods</a><ul>
<li class="chapter" data-level="5.1" data-path="methods.html"><a href="methods.html#math-example"><i class="fa fa-check"></i><b>5.1</b> math example</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>6</b> Applications</a><ul>
<li class="chapter" data-level="6.1" data-path="applications.html"><a href="applications.html#example-one"><i class="fa fa-check"></i><b>6.1</b> Example one</a></li>
<li class="chapter" data-level="6.2" data-path="applications.html"><a href="applications.html#example-two"><i class="fa fa-check"></i><b>6.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>7</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="8" data-path="tabular-data-representation---datatable-1.html"><a href="tabular-data-representation---datatable-1.html"><i class="fa fa-check"></i><b>8</b> Tabular Data Representation - DataTable</a><ul>
<li class="chapter" data-level="8.1" data-path="tabular-data-representation---datatable-1.html"><a href="tabular-data-representation---datatable-1.html#datatable-schema-1"><i class="fa fa-check"></i><b>8.1</b> DataTable Schema</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Minimal Book Example</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tabular-data-representation---datatable" class="section level1 hasAnchor">
<h1><span class="header-section-number">Chapter 2</span> Tabular Data Representation - DataTable<a href="tabular-data-representation---datatable.html#tabular-data-representation---datatable" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="datatable-schema" class="section level2 hasAnchor">
<h2><span class="header-section-number">2.1</span> DataTable Schema<a href="tabular-data-representation---datatable.html#datatable-schema" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Most data science programming languages derive the DataTable schema from the data source. This is easy when the
data source itself has a schema, such as a SQL table, or the data source itself is consistent and complete, such
as a CSV file with no missing field in itâ€™s first row.</p>
<p>In real world, we often work with imperfect data so a defining the schema upfront is preferred.</p>
<p><strong>Example</strong> The FTX exchange provides a RESTful API for users to retrieve balance of all tokens in their wallet.
When the wallet has at least one token with non-trivial balance, the response message body like the following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb2-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">    <span class="dt">&quot;success&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="dt">&quot;result&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb2-4" title="4">        <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-5" title="5">            <span class="dt">&quot;coin&quot;</span><span class="fu">:</span> <span class="st">&quot;ETH&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-6" title="6">            <span class="dt">&quot;total&quot;</span><span class="fu">:</span> <span class="fl">-0.05008361</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-7" title="7">            <span class="dt">&quot;free&quot;</span><span class="fu">:</span> <span class="fl">0.60553512</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-8" title="8">            <span class="dt">&quot;availableForWithdrawal&quot;</span><span class="fu">:</span> <span class="fl">0.60553512</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-9" title="9">            <span class="dt">&quot;availableWithoutBorrow&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-10" title="10">            <span class="dt">&quot;usdValue&quot;</span><span class="fu">:</span> <span class="fl">-65.54655549160535</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-11" title="11">            <span class="dt">&quot;spotBorrow&quot;</span><span class="fu">:</span> <span class="fl">0.05008361</span></a>
<a class="sourceLine" id="cb2-12" title="12">        <span class="fu">}</span></a>
<a class="sourceLine" id="cb2-13" title="13">    <span class="ot">]</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="fu">}</span></a></code></pre></div>
<p>We can easily convert this JSON object into a DataTable in python:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1"><span class="im">import</span> requests</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="im">from</span> pandas <span class="im">import</span> DataFrame</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4">resp <span class="op">=</span> requests.get(<span class="st">&quot;https://ftx.com/api/wallet/balances&quot;</span>) <span class="co"># ignore authentication</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="cf">assert</span> resp.status_code <span class="op">==</span> <span class="dv">200</span>, <span class="ss">f&quot;Request failed </span><span class="sc">{</span>resp<span class="sc">.</span>text<span class="sc">}</span><span class="ss">&quot;</span></a>
<a class="sourceLine" id="cb3-6" title="6">df <span class="op">=</span> DataFrame(resp.json()[<span class="st">&quot;result&quot;</span>])</a></code></pre></div>
<p>However, if the wallet is empty, the response body becomes:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb4-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">    <span class="dt">&quot;success&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="dt">&quot;result&quot;</span><span class="fu">:</span> <span class="ot">[]</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="fu">}</span></a></code></pre></div>
<p>With this empty response, the python script above would generate an empty DataFrame with completely different
schema. The proper way to set schema is to explicitly specify the column names and types:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" title="1">responsJson <span class="op">=</span> []  <span class="co"># assume we got empty data from the API response</span></a>
<a class="sourceLine" id="cb5-2" title="2">I <span class="op">=</span> <span class="kw">lambda</span> x: x.split(<span class="st">&quot;,&quot;</span>)</a>
<a class="sourceLine" id="cb5-3" title="3">df <span class="op">=</span> DataFrame(</a>
<a class="sourceLine" id="cb5-4" title="4">    responsJson, </a>
<a class="sourceLine" id="cb5-5" title="5">    columns<span class="op">=</span>I(<span class="st">&quot;coin,total,free,availableForWithdrawal,availableWithoutBorrow,usdValue,spotBorrow&quot;</span>)</a>
<a class="sourceLine" id="cb5-6" title="6">)</a>
<a class="sourceLine" id="cb5-7" title="7"><span class="cf">for</span> col <span class="kw">in</span> I(<span class="st">&quot;total,free,availableForWithdrawal,availableWithoutBorrow,usdValue,spotBorrow&quot;</span>):</a>
<a class="sourceLine" id="cb5-8" title="8">  df[col] <span class="op">=</span> pd.to_numeric(df[col])</a></code></pre></div>
<p>As you can see, this is verbose. Even worse, the logic is implemeted in two steps:</p>
<ul>
<li>step 1, set column names and load data;</li>
<li>step 2, set schema for each column (and cast column types if necessary).</li>
</ul>
<p>This is un-natural. The better way to implement this would be:</p>
<ul>
<li>step 1, set column names and types;</li>
<li>step 2, load data.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="intro.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/000-DataTable.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
